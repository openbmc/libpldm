{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1955145a_fd06351f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000212
      },
      "writtenOn": "2025-09-18T18:11:49Z",
      "side": 1,
      "message": "@andrew@codeconstruct.com.au So, I ran into a snag with your suggestion. Just having these as __attribute__(weak) did not let me override the function by defining it in https://github.com/openbmc/libpldm/blob/main/tests/transport/send_recv_timeout.cpp#L7. Probably because we build libpldm as a library and include it into the C++ test executables.\n\nI could have send_recv_timeout.cpp define libpldm_clock_gettimeval and notice that libpldm calls its own internal function since the linter does not hold onto it.\n\nThe only way was for me to do some function pointer, expose another `libpldm_set_impl_gettimeval` which takes in a function pointer which can override internal aspects. Any ideas? Probably some linker magic?",
      "revId": "063135d2b8bdc73f873524b15aec2472f99518b2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d82e8bf3_78a786e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-09-19T03:35:28Z",
      "side": 1,
      "message": "So, starting from what you have, poking around with `readelf` and `LD_DEBUG\u003dbindings`, we get:\n\n```\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((bb22eb16))\u003e meson compile -C build.trixie\nINFO: autodetecting backend as ninja\nINFO: calculating backend command to run: /home/andrew/.local/bin/ninja -C /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie\nninja: Entering directory `/home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie\u0027\n[28/28] Linking target tests/oem_ibm_fileio\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((bb22eb16))\u003e readelf -Ws /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/src/libpldm.so.0 | grep libpldm_\n  1075: 000000000000f600    96 FUNC    LOCAL  DEFAULT   12 libpldm_clock_gettimeval\n  1091: 000000000000f570   135 FUNC    LOCAL  DEFAULT   12 libpldm_timeval_is_valid\n  1101: 000000000000f540    46 FUNC    LOCAL  DEFAULT   12 libpldm_timeval_to_msec\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((bb22eb16))\u003e readelf -Ws build.trixie/tests/transport_send_recv_timeout | grep libpldm\n  7192: 0000000000028e40    13 FUNC    WEAK   DEFAULT   14 _Z24libpldm_clock_gettimevalP7timeval\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((bb22eb16))\u003e LD_LIBRARY_PATH\u003d/home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/src LD_DEBUG\u003dbindings /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/tests/transport_send_recv_timeout 2\u003e\u00261 | grep libpldm_clock_gettimeval\n```\n\nThings to notice here are:\n\n1. The symbol in `transport_send_recv_timeout` has had C++ name mangling applied (`_Z24libpldm_clock_gettimevalP7timeval`) while the symbol in `libpldm.so.0` has not (`libpldm_clock_gettimeval`)\n2. That `libpldm_clock_gettimeval` in `libpldm.so.0` is marked `LOCAL` while the intended symbol in `transport_send_recv_timeout` is marked `WEAK`.\n\nRegarding 2, it should be the case that the symbol in `libpldm.so.0` is marked `WEAK` and the one in `transport_send_recv_timeout` is marked `FUNC` (and neither are marked `LOCAL`).\n\nAfter applying some fixes, we have:\n\n```\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((3174a159))\u003e meson compile -C build.trixie\nINFO: autodetecting backend as ninja\nINFO: calculating backend command to run: /home/andrew/.local/bin/ninja -C /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie\nninja: Entering directory `/home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie\u0027\n[28/28] Linking target tests/oem_meta_fileio\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((3174a159))\u003e readelf -Ws /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/src/libpldm.so.0 | grep libpldm_\n   447: 000000000000f610    96 FUNC    WEAK   DEFAULT   12 libpldm_clock_gettimeval\n  1090: 000000000000f580   135 FUNC    LOCAL  DEFAULT   12 libpldm_timeval_is_valid\n  1100: 000000000000f550    46 FUNC    LOCAL  DEFAULT   12 libpldm_timeval_to_msec\n  1285: 000000000000f610    96 FUNC    WEAK   DEFAULT   12 libpldm_clock_gettimeval\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((3174a159))\u003e readelf -Ws build.trixie/tests/transport_send_recv_timeout | grep libpldm\n   242: 0000000000028e40    13 FUNC    GLOBAL DEFAULT   14 libpldm_clock_gettimeval\n  7423: 0000000000028e40    13 FUNC    GLOBAL DEFAULT   14 libpldm_clock_gettimeval\n[I] 0 andrew@heihei ~/s/o/o/l/origin ((3174a159))\u003e LD_LIBRARY_PATH\u003d/home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/src LD_DEBUG\u003dbindings /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/tests/transport_send_recv_timeout 2\u003e\u00261 | grep libpldm_clock_gettimeval\n     58090:     binding file /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/src/libpldm.so.0 [0] to /home/andrew/src/openbmc.org/openbmc/libpldm/origin/build.trixie/tests/transport_send_recv_timeout [0]: normal symbol `libpldm_clock_gettimeval\u0027\n```\n\nThis errors as expected.",
      "parentUuid": "1955145a_fd06351f",
      "revId": "063135d2b8bdc73f873524b15aec2472f99518b2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93195625_9045578b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-09-19T03:38:16Z",
      "side": 1,
      "message": "\u003e ... and the one in `transport_send_recv_timeout` is marked `FUNC` (and neither are marked `LOCAL`).\n\nUh, that should rather be: \"... and the one in `transport_send_recv_timeout` is marked `GLOBAL` (and neither are marked `LOCAL`).\"",
      "parentUuid": "d82e8bf3_78a786e7",
      "revId": "063135d2b8bdc73f873524b15aec2472f99518b2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}