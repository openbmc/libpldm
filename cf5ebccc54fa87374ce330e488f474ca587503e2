{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "52c2d67a_c5b08fbd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "It seems like this would be quite a bit easier to read and reason about if we came up with a different mechanism for UT than compilation-switch-hidden friend declarations. A couple of options come to mind, in order of my personal preference:\n\n1. Make the public interface testable. Who are we protecting with the current implementation? Are the interfaces that easy to use incorrectly? Should we just be providing safer interfaces if so? What is the worst that will happen if this interfaces are used incorrectly?\n\n2. Just use \"seam mocking\" instead, i.e. make each layer\u0027s public interface useable for each classes responsibility but obfuscate the inner layers from the end user\n\n3. Use compile time dependency injection for your test fixtures. I don\u0027t like this as much personally, as it complicates the code for the sake of UT, i.e. now I need to understand a bunch of CRTP-esque declarations just to reason about my pldm parser.\n\n\nI understand that UT can often be tricky in C++, but it seems odd to me to add this much compile time switching for the non-production path, almost all of the time, I want to read the production path to figure out whats going on.\n\nThat said, thanks for this change, I\u0027ve looked at doing this elsewhere and written something similar to support it, having it in a reusable place like libpldm will be great.",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d00deff1_e1e05dc3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "\u003e Make the public interface testable. Who are we protecting with the current implementation?\n\nIt\u0027s a parser so no one besides the implementation should be able to construct these objects.\n\n\u003e Just use \"seam mocking\" instead, i.e. make each layer\u0027s public interface\n useable for each classes responsibility but obfuscate the inner layers \nfrom the end user\n\nI don\u0027t understand how that would look like. Would you like to fork my patch? Maybe it will be easier to understand from the code itself.\n\n\u003e I understand that UT can often be tricky in C++, but it seems odd to me \nto add this much compile time switching for the non-production path, \nalmost all of the time, I want to read the production path to figure out\n whats going on.\n\nIf i were to use a library like PackageParser, i would look at examples / tests first and if those are fine then no need to dig into implementation details.\n\n\u003e I\u0027ve looked at doing this elsewhere and written something similar to \nsupport it, having it in a reusable place like libpldm will be great.\n\nWell then it\u0027s  \u003e\u003d 3 places which need the PackageParser. There\u0027s `pldm`, `phosphor-bmc-code-mgmt`, and your use-case üòä",
      "parentUuid": "52c2d67a_c5b08fbd",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c10d4c8a_85fc3342",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-22T17:52:58Z",
      "side": 1,
      "message": "my larger point is that we\u0027re probably making more problems than we\u0027re solving with somewhat draconian public/private/friend disctinctions.\n\nWhats the worst that happens if someone calls the Package constructor? what damage could they actually do with it? It doesn\u0027t seem like they\u0027ll be able to influence the parsing in any way, they\u0027ll just have a Package object that they can\u0027t move or copy.\n\nWhy shouldn\u0027t someone be able to construct a DescriptorData from a vector of data? They\u0027ll just have a data type they can\u0027t do much with, and sure its maybe its wasteful, but they won\u0027t really be able to do anything with it.\n\nWe\u0027re imposing restrictions that are making it harder than necessary to test this, and then we\u0027re making the code more complicated yet to facilitate said testing.",
      "parentUuid": "d00deff1_e1e05dc3",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c922e5c_4d7f5c06",
        "filename": "bindings/cpp/firmware_update.cpp",
        "patchSetId": 36
      },
      "lineNbr": 41,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "nit, std::make_unique doesn\u0027t work here? it would be slightly less verbose. Also below on line 76.",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "faf60663_5bd29780",
        "filename": "bindings/cpp/firmware_update.cpp",
        "patchSetId": 36
      },
      "lineNbr": 41,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "It does not work since that template is not our friend.\n\nSo it cannot call the private constructor.",
      "parentUuid": "9c922e5c_4d7f5c06",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d019ca1_c94d5cb7",
        "filename": "bindings/cpp/firmware_update.cpp",
        "patchSetId": 36
      },
      "lineNbr": 103,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "nit: \u003ddefault doesn\u0027t work here? is this an ABI stability concern?",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33637b7f_27cf135b",
        "filename": "bindings/cpp/firmware_update.cpp",
        "patchSetId": 36
      },
      "lineNbr": 103,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "Changed it to `\u003d default;`. I don\u0027t think it will make a difference here since it\u0027s part of the cpp.",
      "parentUuid": "1d019ca1_c94d5cb7",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21082e5f_dd2ad34b",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 26,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "do we want explicit here?",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aefefa83_2f3f0f41",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 26,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "probably. fixed it üëç",
      "parentUuid": "21082e5f_dd2ad34b",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e956fdb_6d7b5cd7",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 39,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "this seems like a very odd set of constructiors? was the move ctor meant to be deleted? I\u0027m having a difficult time imagining a case where I\u0027d want to move construct but not move assign an object.",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e632f820_81f3dd32",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 39,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "yep, my mistake. I should have simply inherited from `NonCopyableNonMoveable` like the other classes do. Fixed it.",
      "parentUuid": "4e956fdb_6d7b5cd7",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82bc7868_a41a81e1",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 53,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "This seems like it would be a good candidate for a free function? Whats the purpose of this class? I cant construct it, except by move construction, it seems I can only call this static method.",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b51d2c7a_91f2cb0b",
        "filename": "include/libpldm/bindings/cpp/firmware_update.hpp",
        "patchSetId": 36
      },
      "lineNbr": 53,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "The helper and parse functions need to construct a few objects. So `PackageParser` is a friend of these classes to facilitate that.\n\nI did not want to copy-paste these 2 function signatures into the friend declarations of the classes they construct, since it would be verbose and repetitive.\n\nAnd we cannot make an entire namespace a friend, right? So i did not see a way to solve it without a class.\n\n\nI\u0027m tentatively closing this comment but very much open to other solutions here.",
      "parentUuid": "82bc7868_a41a81e1",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45d5cd4f_15359f2a",
        "filename": "include/libpldm/bindings/cpp/types.hpp",
        "patchSetId": 36
      },
      "lineNbr": 79,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "Do we have any data to show that we can\u0027t reasonably just use the checked access members as the public interface?",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1eff2181_914d899e",
        "filename": "include/libpldm/bindings/cpp/types.hpp",
        "patchSetId": 36
      },
      "lineNbr": 79,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "It worked out to make the unchecked access members private to this class.\n\nThanks for this fix üëç",
      "parentUuid": "45d5cd4f_15359f2a",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0173a1c_45cdf7f7",
        "filename": "include/libpldm/bindings/cpp/types.hpp",
        "patchSetId": 36
      },
      "lineNbr": 201,
      "author": {
        "id": 1002504
      },
      "writtenOn": "2026-01-20T22:33:11Z",
      "side": 1,
      "message": "its relatively difficult to read this with all of these ifdefs littered about. Can we come up with a way to consolidate these? I have a feeling that some compile time DI would probably end up a bit cleaner.",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4cb3a17_a3e3af56",
        "filename": "include/libpldm/bindings/cpp/types.hpp",
        "patchSetId": 36
      },
      "lineNbr": 201,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-22T07:42:42Z",
      "side": 1,
      "message": "yep, it\u0027s not looking nice ... compacted those to only one `#ifdef` per class for now üòä\n\n\u003e I have a feeling that some compile time DI would probably end up a bit cleaner.\n\nCan you go into detail here?\n\nI would also prefer a solution without `#ifdef`.",
      "parentUuid": "d0173a1c_45cdf7f7",
      "revId": "cf5ebccc54fa87374ce330e488f474ca587503e2",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}