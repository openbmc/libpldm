{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5fefdb49_c790f136",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002348
      },
      "writtenOn": "2025-11-24T06:41:30Z",
      "side": 1,
      "message": "Changes done:\n1. Add macros in Changelog.md instead of function in ### Added section\n2. Remove unnecessary typedefs\n3. Remove _t from my structs\n4. Rename macros with foreach_\n5. Use msgbuf APIs\n6. Remove check for comp eff count \u003d 0\n7. Add error code support\n8. Now accepts void buffer instead of struct\n9. Discard buffers on errors\n10. Add more test cases",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "802f2fb4_01ba507e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Hi Jino,\n\nThanks for the improvements. I have left quite a few comments, but we\u0027re starting to move down the tree of problems (away from architectural design concerns towards implementation design concerns) - so I want you to know I think this is heading in the right direction and to not be too worried about the volume.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "585aeef7_dbc718d2",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Other parts of the libpldm API use the contracted form of `_iter`. I prefer we be consistent.\n\nCan you please audit the change for other instances as well?\n\nNote: There is an exception: Any symbols derived from names in relevant specifications should not have contractions. I ask this so it\u0027s easy to map the implementation back to the spec without having to guess at what letters someone chose to drop.",
      "range": {
        "startLine": 45,
        "startChar": 30,
        "endLine": 45,
        "endChar": 39
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74364b0a_6541edc1",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 47,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "We have `struct variable_field` for this - while I don\u0027t think its definition is great (should be `const void *ptr`), let\u0027s at least use what we have.\n\nPlease audit the change for other opportunities to switch to it.",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 47,
        "endChar": 18
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b201c203_02b40be5",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 109,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Is it necessary to take a different design to e.g. the PLDM firmware update package parsing APIs? I\u0027d like to be consistent if we can.\n\nI feel that using `-ENODATA` as a signal to stop iteration will be error-prone, as it broadly behaves like any other error. Callers can no-longer just test whether the returned value is less than zero - they need an explicit carve-out for `-ENODATA`. It puts us down around a score of 3 by https://ozlabs.org/~rusty/index.cgi/tech/2008-03-30.html\n\nBy contrast, the firmware update package parsing APIs use a pattern of `*_init()` / `*_next()` / `*_end()` functions, where the latter two just return `bool`, and `_end()` being `const`. The way we extract the data is using the `decode_*_from_iter()`.\n\nPlease audit the rest of the patch for similar concerns.",
      "range": {
        "startLine": 107,
        "startChar": 0,
        "endLine": 109,
        "endChar": 55
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70d53725_43d84385",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 118,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "I prefer we use `_end` as a suffix for consistency with the other iterator APIs.\n\nPlease audit the rest of the patch for similar concerns.",
      "range": {
        "startLine": 118,
        "startChar": 37,
        "endLine": 118,
        "endChar": 46
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6405fe0a_7964ef8f",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 175,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Why are we asking callers to decompose this? I think we can improve the ergonomics. Can we please rather take a `struct pldm_state_sensor_pdr` and handle accessing the necessary members in the implementation?",
      "range": {
        "startLine": 170,
        "startChar": 0,
        "endLine": 175,
        "endChar": 62
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1555b96f_0303afaf",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 181,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Must we ask for this? I feel it\u0027s a bit of a distraction for users. If we\u0027re concerned about shadowing we can prefix the name of the variable with e.g. `libpldm_` as we\u0027re already reserving that (along with `pldm_`) anyway.",
      "range": {
        "startLine": 178,
        "startChar": 0,
        "endLine": 181,
        "endChar": 35
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "09ab5d0d_498b4efc",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 232,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "What is `pdr`? A `std::vector\u003cuint8_t\u003e`? We should be passing around instances of representative types, i.e. a `struct pldm_state_sensor_pdr *`, not a raw byte representation of an object.\n\nExpecting callers to pass a correct `std::vector\u003cuint8_t\u003e` is at most a 2 on the [How Do I Make This Hard to Misuse?](https://ozlabs.org/~rusty/index.cgi/tech/2008-03-30.html) scale, and probably more in the territory of [What If I Don\u0027t Actually Like My Users?](https://ozlabs.org/~rusty/index.cgi/tech/2008-04-01.html). I really prefer we make it easier to use correctly (harder to use incorrectly) than that.\n\nLet\u0027s pass a `struct pldm_state_sensor_pdr *` directly. We\u0027ll still need the size argument as the struct contains a flexible array, but that\u0027s fine (even if it feels unusual - that\u0027s flexible arrays for you).",
      "range": {
        "startLine": 232,
        "startChar": 45,
        "endLine": 232,
        "endChar": 67
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d99627dc_5f136ef7",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 233,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Please use `snake_case` as is idiomatic for C.",
      "range": {
        "startLine": 233,
        "startChar": 54,
        "endLine": 233,
        "endChar": 61
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f47f73bb_fb466104",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 237,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "I don\u0027t think there\u0027s a need to distinguish between `inner_rc` and `rc` in the example. If the outer loop header errors we should never execute its body. If the inner header errors we can return directly from its test.",
      "range": {
        "startLine": 237,
        "startChar": 62,
        "endLine": 237,
        "endChar": 70
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "000eddd6_2f80a123",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 241,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "By the above, I\u0027d add `return rc;` here.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f1448808_b59a5f24",
        "filename": "include/libpldm/pdr.h",
        "patchSetId": 2
      },
      "lineNbr": 245,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "I\u0027d suggest `return rc;` here too.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c59006cf_1c14c662",
        "filename": "include/libpldm/platform.h",
        "patchSetId": 2
      },
      "lineNbr": 15,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "This change is unnecessary.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1070e4f8_9961ed49",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2410,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Bit of a nit, but can you please collapse these into one condition, and test them in the same order as the formal parameters?\n\n\n```suggestion\n\tif (!pdr_buf || !iter) {\n\t\treturn -EINVAL;\n\t}\n```\n\nHowever, also take into account the comments from the header.",
      "range": {
        "startLine": 2404,
        "startChar": 1,
        "endLine": 2410,
        "endChar": 2
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af9a25ac_9ff2afd6",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2413,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "There should be no cast here.",
      "range": {
        "startLine": 2413,
        "startChar": 8,
        "endLine": 2413,
        "endChar": 19
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "021c34cb_ab56dc1c",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2415,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "`pldm_msgbuf_discard()` is only necessary if the msgbuf instance is valid, which is not the case when we error out of `pldm_msgbuf_init_errno()`. In this instance you can `return rc;` directly.\n\nCan you please audit the rest of the patch for similar concerns?\n\nFor the rest of the function, you need `pldm_msgbuf_discard()`, which you\u0027ve done correctly.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d743f04_cf7487aa",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2423,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "So going back to some of the discussion on the header, this would not be necessary if we take `struct pldm_state_sensor_pdr *pdr` as an argument to the function. You can instead initialise the msgbuf with `possible_states` as the buffer argument, and use `pdr-\u003ecomposite_sensor_count` as the size argument.\n\nActually, looking further down, none of that would be necessary. We\u0027d initialise the iterator object directly from the information we already have available:\n\n```\n...\n\nif (pdr_size \u003c sizeof(struct pldm_state_sensor_pdr)) {\n    return -EOVERFLOW;\n}\n\n...\n\niter-\u003ecursor \u003d pdr-\u003epossible_states;\niter-\u003eremaining \u003d pdr_size - sizeof(struct pldm_state_sensor_pdr);\niter-\u003etotal_count \u003d pdr-\u003ecomposite_effecter_count;\niter-\u003ecurrent_index \u003d 0;\n\nreturn 0;\n```",
      "range": {
        "startLine": 2418,
        "startChar": 1,
        "endLine": 2423,
        "endChar": 2
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f837c64_f6230348",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2449,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Please see the discussion on the header regarding separation of the decoding from the `_next()` implementation (via a `decode_*_from_iter()` API).",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3f01aef_fec87168",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2481,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "No need to test `rc` here, `state_set_id` is not used.\n\nThat said, why is it not used? Should something be consuming this information?",
      "range": {
        "startLine": 2479,
        "startChar": 1,
        "endLine": 2481,
        "endChar": 2
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18fa4b43_eca1215a",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2484,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "In this case you _do_ need to test `rc`, as you use the value of `possible_states_size` in the test on line 2488.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7bbb9d3a_a7d261f3",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2498,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Please don\u0027t reach into `ctx` this way. You can pass `iter-\u003ecursor` and `iter-\u003eremaining` to `pldm_msgbuf_span_remaining()` to extract the values you need.\n\nPlease audit the rest of the patch for similar concerns.",
      "range": {
        "startLine": 2497,
        "startChar": 1,
        "endLine": 2498,
        "endChar": 34
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3aa91abe_df523acf",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2505,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "We haven\u0027t tested that `possible_states_size \u003e\u003d sizeof(struct state_effecter_possible_states)` holds. This is a memory-safety hazard that needs to be fixed.",
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba4f7d8e_8b235111",
        "filename": "src/dsp/pdr.c",
        "patchSetId": 2
      },
      "lineNbr": 2520,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-11-28T00:04:33Z",
      "side": 1,
      "message": "Can we rather use `\u0026states-\u003estates-\u003ebyte` and drop the cast?",
      "range": {
        "startLine": 2520,
        "startChar": 16,
        "endLine": 2520,
        "endChar": 33
      },
      "revId": "a0479a981ad21d5595550094ecf28f3e09071374",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}